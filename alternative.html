<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>NAAB ↔ NCARB Matrix</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Orienta&display=swap" rel="stylesheet" />
  <!-- Tailwind (CDN for dev; build Tailwind for production) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root { color-scheme: dark; }
    body { font-family: 'Orienta', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .matrix th, .matrix td { padding: 0; }
  </style>
</head>
<body class="bg-neutral-900 text-white min-h-screen">
  <header class="sticky top-0 z-40 bg-black/70 backdrop-blur border-b border-white/10">
    <div class="max-w-screen-2xl mx-auto px-4 2xl:px-8 py-3 flex items-center justify-between">
      <div class="text-sm md:text-base text-white/70">
        Click a <span class="text-white">cell</span> to set both filters, or a header to set one.
      </div>
      <button id="clearAll" class="text-sm md:text-base text-white/70 hover:text-white underline underline-offset-4">
        Clear
      </button>
    </div>
  </header>

  <main class="max-w-screen-2xl mx-auto px-4 2xl:px-8 py-6">
    <h1 class="text-3xl md:text-4xl font-semibold tracking-tight">Select a cell to see tasks</h1>
    <p class="mt-2 text-white/70 max-w-3xl text-sm md:text-base">
      Any selection saves to local storage and routes to <code>tasks.html</code>.
    </p>

    <!-- MOBILE (use mobile UI up to < xl) -->
    <section class="mt-6 xl:hidden">
      <div class="rounded-xl border border-white/10 bg-neutral-800/40 p-4 space-y-4">
        <h2 class="text-xl font-semibold">Select the following:</h2>

        <div class="space-y-1">
          <label for="naabSelect" class="text-sm text-white/70">NAAB Criteria</label>
          <div class="relative">
            <select id="naabSelect"
              class="w-full appearance-none rounded-lg bg-neutral-800 border border-white/10 px-3 py-2 pr-9 text-white/90 focus:outline-none focus:ring-2 focus:ring-[#fedc4b]">
              <option value="">Select a NAAB criteria</option>
            </select>
            <span class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2">▾</span>
          </div>
        </div>

        <div class="space-y-1">
          <label for="compSelect" class="text-sm text-white/70">NCARB Competency</label>
          <div class="relative">
            <select id="compSelect" disabled
              class="w-full appearance-none rounded-lg bg-neutral-800 border border-white/10 px-3 py-2 pr-9 text-white/90 disabled:text-white/40 disabled:opacity-60 focus:outline-none focus:ring-2 focus:ring-[#fedc4b]">
              <option value="">Select a competency</option>
            </select>
            <span class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2">▾</span>
          </div>
          <p class="text-xs text-white/60 mt-1">The second list is filtered by the first.</p>
        </div>

        <div class="flex items-center gap-3 pt-2">
          <button id="mobileConfirm" disabled
            class="rounded-md bg-neutral-700 px-4 py-2 text-sm hover:bg-[#fedc4b] hover:text-black disabled:opacity-50">
            Confirm
          </button>
          <button id="mobileClear" class="text-sm text-white/70 hover:text-white underline underline-offset-4">
            Clear
          </button>
        </div>
      </div>
    </section>

    <!-- DESKTOP TABLE (xl and up) -->
    <section class="mt-8 hidden xl:block">
      <div class="flex items-center gap-4 text-xs md:text-sm text-white/70 mb-3">
        <span class="inline-block h-3 w-3 rounded-sm bg-[#fedc4b] align-middle"></span>
        <span>Mapped (highlighted)</span>
        <span class="inline-block h-3 w-3 rounded-sm bg-white/10 ml-4 align-middle"></span>
        <span>Unmapped (still clickable)</span>
      </div>

      <div class="rounded-xl border border-white/10 overflow-hidden">
        <table id="matrix"
          class="matrix w-full table-fixed border-separate border-spacing-0 text-xs md:text-sm leading-tight">
          <!-- Built by JS -->
        </table>
      </div>
    </section>
  </main>

  <!-- Tiny toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 hidden">
    <div class="rounded-lg bg-black/80 backdrop-blur px-4 py-2 text-sm border border-white/10">Filters saved</div>
  </div>

  <script>
    /*********** DATA ***********/
    const NAAB_CODES = ['P1','P2','P3','P4','P5','P6','P7','P8','S1','S2','S3','S4','S5','S6'];

    // Titles only (no "P1 / S1" text in the row headers)
    const NAAB_TITLES = {
      P1:'Career Paths',
      P2:'Design',
      P3:'Ecological Knowledge and Responsibility',
      P4:'History and Theory',
      P5:'Research and Innovation',
      P6:'Leadership and Collaboration',
      P7:'Learning and Teaching Culture',
      P8:'Social Equity and Inclusion',
      S1:'Health, Safety, and Welfare in the Built Environment',
      S2:'Professional Practice',
      S3:'Regulatory Context',
      S4:'Technical Knowledge',
      S5:'Design Synthesis',
      S6:'Building Integration'
    };

    // Add icon path for each competency (adjust paths if your icons are in a subfolder)
    const COMPETENCIES = [
      { id:1,  short:'01', label:'Identity Regulations',                icon:'01.png' },
      { id:2,  short:'02', label:'Existing Conditions & Feasibility',   icon:'02.png' },
      { id:3,  short:'03', label:'Goals & Programming',                 icon:'03.png' },
      { id:4,  short:'04', label:'Environmental & Sustainability',      icon:'04.png' },
      { id:5,  short:'05', label:'Social Impact',                       icon:'05.png' },
      { id:6,  short:'06', label:'Designing',                           icon:'06.png' },
      { id:7,  short:'07', label:'Documenting',                         icon:'07.png' },
      { id:8,  short:'08', label:'Design Development',                  icon:'08.png' },
      { id:9,  short:'09', label:'Construction Administration',         icon:'09.png' },
      { id:10, short:'10', label:'Construction Evaluation',             icon:'10.png' },
      { id:11, short:'11', label:'Contracts',                           icon:'11.png' },
      { id:12, short:'12', label:'Project Planning',                    icon:'12.png' },
      { id:13, short:'13', label:'Project Management',                  icon:'13.png' },
      { id:14, short:'14', label:'Legal Practice',                      icon:'14.png' },
      { id:15, short:'15', label:'Ethical Practice',                    icon:'15.png' },
      { id:16, short:'16', label:'Business Management',                 icon:'16.png' }
    ];

    // Your current alignment map (sample)
    const ALIGN = {
      P1:[14], P2:[3,4,5,6], P3:[4], P4:[3,5],
      P5:[4,5,6], P6:[3,5,8,12,13,15], P7:[12,13,15], P8:[5],
      S1:[4], S2:[14,15,16], S3:[1,2,6,7],
      S4:[6,7,8,10], S5:[1,2,3,4,5,6], S6:[8]
    };

    /*********** Behavior & storage ***********/
    const STORAGE_KEY = 'LicensureFilters';
    const NEXT_PAGE = 'tasks.html';
    const AUTO_NAV = true; // route after any click/confirm

    const filtersGet = () => { try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; } catch { return {}; } };
    function filtersSet(next){
      const merged = { ...filtersGet(), ...next };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(merged));
      showToast('Filters saved');
      if (AUTO_NAV) setTimeout(() => { window.location.href = NEXT_PAGE; }, 150);
    }
    function clearFilters(){ localStorage.removeItem(STORAGE_KEY); showToast('Filters cleared'); }
    function showToast(msg){
      const t = document.getElementById('toast');
      t.querySelector('div').textContent = msg;
      t.classList.remove('hidden');
      clearTimeout(showToast._tid);
      showToast._tid = setTimeout(() => t.classList.add('hidden'), 1100);
    }

    /*********** Desktop matrix ***********/
    function buildMatrix(){
      const table = document.getElementById('matrix');
      table.innerHTML = '';

      // Wider layout to accommodate icons and larger text
      const COL_W   = 74;   // px per competency column
      const ROWHDR_W= 360;  // px for row header

      const thead = document.createElement('thead');
      const trH = document.createElement('tr');

      // Corner
      const corner = document.createElement('th');
      corner.className = "sticky left-0 top-0 z-20 bg-neutral-900/95 backdrop-blur border-b border-white/10 text-left";
      corner.style.width = ROWHDR_W + 'px';
      corner.innerHTML = `<div class="px-3 py-3 font-semibold text-sm">NAAB ↔ Competency</div>`;
      trH.appendChild(corner);

      // Column headers (icon + number, hover reveals label)
      COMPETENCIES.forEach(c => {
        const th = document.createElement('th');
        th.scope = 'col';
        th.className = "top-0 sticky z-10 bg-neutral-900/95 backdrop-blur border-b border-white/10";
        th.style.width = COL_W + 'px';
        th.innerHTML = `
          <button data-col="${c.id}" title="${c.label}"
            class="group w-full h-full text-left focus:outline-none">
            <div class="px-1 py-3 flex flex-col items-center justify-center gap-1">
              <img src="${c.icon}" alt="${c.label} icon" loading="lazy" class="h-8 w-8 object-contain" />
              <span class="inline-block px-1 py-0.5 rounded-sm text-sm font-bold group-hover:bg-[#fedc4b] group-hover:text-black transition">
                ${c.short}
              </span>
              <span class="text-[11px] text-white/80 opacity-0 group-hover:opacity-100 transition text-center leading-tight">
                ${c.label}
              </span>
            </div>
          </button>`;
        trH.appendChild(th);
      });
      thead.appendChild(trH);
      table.appendChild(thead);

      // Body
      const tbody = document.createElement('tbody');
      NAAB_CODES.forEach(code => {
        const tr = document.createElement('tr');

        // Row header (TITLE ONLY; no P1/S1 text)
        const th = document.createElement('th');
        th.scope = 'row';
        th.className = "sticky left-0 z-10 bg-neutral-900/95 backdrop-blur border-r border-white/10";
        th.style.width = ROWHDR_W + 'px';
        th.innerHTML = `
          <button data-row="${code}" class="group w-full text-left focus:outline-none">
            <div class="px-3 py-3">
              <div class="text-sm md:text-base text-white/90 leading-snug">
                ${NAAB_TITLES[code] || ''}
              </div>
            </div>
          </button>`;
        tr.appendChild(th);

        // Cells (ALL clickable; mapped are highlighted)
        COMPETENCIES.forEach(c => {
          const mapped = (ALIGN[code] || []).includes(c.id);
          const td = document.createElement('td');
          td.className = "border-t border-white/10";
          td.style.width = COL_W + 'px';
          td.innerHTML = `
            <button data-cell-row="${code}" data-cell-col="${c.id}"
              class="w-full h-10 lg:h-11 ${mapped ? 'bg-[#fedc4b] text-black hover:opacity-90' : 'bg-white/10 hover:bg-white/15 text-white/80'}
                     transition rounded-[3px] focus:outline-none focus-visible:ring-2 focus-visible:ring-[#fedc4b]/60"
              title="${NAAB_TITLES[code] || code} × ${c.short} — ${c.label}">
            </button>`;
          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });
      table.appendChild(tbody);

      // Events
      table.addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;

        // Column header → set Competency only
        if (btn.dataset.col) {
          filtersSet({ Competency: Number(btn.dataset.col) });
          return;
        }
        // Row header → set NAAB only
        if (btn.dataset.row) {
          filtersSet({ NAAB: [btn.dataset.row] });
          return;
        }
        // Cell → set BOTH (even if "empty" visually)
        if (btn.dataset.cellRow) {
          const naab = btn.dataset.cellRow;
          const comp = Number(btn.dataset.cellCol);
          filtersSet({ NAAB: [naab], Competency: comp });
        }
      });
    }

    /*********** Mobile linked selects ***********/
    function buildMobile(){
      const naabSel  = document.getElementById('naabSelect');
      const compSel  = document.getElementById('compSelect');
      const confirm  = document.getElementById('mobileConfirm');
      const clearBtn = document.getElementById('mobileClear');

      // NAAB options (code + title in mobile for clarity)
      NAAB_CODES.forEach(code => {
        const opt = document.createElement('option');
        opt.value = code;
        opt.textContent = `${code} — ${NAAB_TITLES[code] || ''}`;
        naabSel.appendChild(opt);
      });

      function loadComps(list){
        compSel.innerHTML = '<option value="">Select a competency</option>';
        list.forEach(c => {
          const opt = document.createElement('option');
          opt.value = c.id;
          opt.textContent = `${c.short} · ${c.label}`;
          compSel.appendChild(opt);
        });
      }
      loadComps(COMPETENCIES);

      naabSel.addEventListener('change', () => {
        const code = naabSel.value;
        const allowed = (ALIGN[code] || []);
        const filtered = COMPETENCIES.filter(c => allowed.includes(c.id));
        compSel.disabled = !code;
        loadComps(filtered);
        compSel.value = '';
        confirm.disabled = true;
      });

      compSel.addEventListener('change', () => {
        confirm.disabled = !(naabSel.value && compSel.value);
      });

      confirm.addEventListener('click', () => {
        const naab = naabSel.value;
        const comp = Number(compSel.value);
        if (!naab || !comp) return;
        filtersSet({ NAAB:[naab], Competency:comp });
      });

      clearBtn.addEventListener('click', (e) => {
        e.preventDefault();
        naabSel.value = '';
        compSel.value = '';
        compSel.disabled = true;
        confirm.disabled = true;
        clearFilters();
      });
    }

    /*********** Global controls ***********/
    document.getElementById('clearAll').addEventListener('click', (e) => {
      e.preventDefault();
      clearFilters();
    });

    // Init
    buildMatrix();
    buildMobile();
  </script>
</body>
</html>
